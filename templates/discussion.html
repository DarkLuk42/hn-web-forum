# coding: utf-8
<%inherit file="layout/default.html"/>

<%block name="title">${discussion["title"]|h}</%block>
<%block name="content">
    <h1>${discussion["title"]|h}</h1>
    <p>
        Hier sind alle Diskussionen aus dem Thema '${theme['name']}' aufgelistet.
    </p>
    %if userrole == "ADMIN":
        <form class="inline-form" action="/delete_discussion" method="post">
            <input type="hidden" name="theme" value="${theme['alias']}">
            <input type="hidden" name="discussion" value="${discussion['alias']}"/>
            <input class="btn-delete" type="submit" value="Diskussion löschen"/>
        </form>
        <div class="hidden-form">
            <button class="show-form btn-edit">bearbeiten</button>
            <form action="/update_discussion" method="post">
                <input type="hidden" name="theme" value="${theme['alias']}">
                <input type="hidden" name="discussion" value="${discussion['alias']}"/>
                <input type="text" name="title" placeholder="Titel" value="${discussion['title']}" class="required"/>
                <input type="submit" value="Diskussion bearbeiten"/>
                <button class="hide-form">abbrechen</button>
            </form>
        </div>
    %endif
    <ul>
        %for article in discussion["articles"]:
            <li>
                %if discussion["articles"][article]["truncated"] == False:
                    ${discussion["articles"][article]["title"]|h}
                    ${discussion["articles"][article]["content"]|h}
                    ${discussion["articles"][article]["owner"]}
                    ${discussion["articles"][article]["timestamp"]}
                    %if userrole == "ADMIN" or (userrole == "USER" and username == discussion["articles"][article]["owner"] and discussion["articles"][article]["alias"] == last_article["alias"]):
                        <form class="inline-form" action="/delete_article" method="post">
                            <input type="hidden" name="theme" value="${theme['alias']}">
                            <input type="hidden" name="discussion" value="${discussion['alias']}"/>
                            <input type="hidden" name="article" value="${article}"/>
                            <input class="btn-delete" type="submit" value="Beitrag löschen"/>
                        </form>
                        <div class="hidden-form">
                            <button class="show-form btn-edit">bearbeiten</button>
                            <form action="/update_article" method="post">
                                <input type="hidden" name="theme" value="${theme['alias']}">
                                <input type="hidden" name="discussion" value="${discussion['alias']}"/>
                                <input type="hidden" name="article" value="${article}"/>
                                <input type="text" name="title" placeholder="Titel" value="${discussion['articles'][article]['title']}" class="required"/>
                                <textarea name="content" placeholder="Inhalt" class="required">${discussion['articles'][article]['content']}</textarea>
                                <input type="submit" value="Diskussion bearbeiten"/>
                                <button class="hide-form">abbrechen</button>
                            </form>
                        </div>
                    %endif
                %elif userrole == "ADMIN":
                    Dieser Beitrag wurde gelöscht (${discussion["articles"][article]["title"]|h}).
                %else:
                    Dieser Beitrag wurde gelöscht.
                %endif
            </li>
        %endfor
    </ul>
    <form action="/create_article" method="post">
        <input type="hidden" name="theme" value="${theme['alias']}">
        <input type="hidden" name="discussion" value="${discussion['alias']}">
        <input type="text" name="title" placeholder="Titel" class="required"/>
        <textarea name="content" placeholder="Inhalt" class="required"></textarea>
        <input type="submit" value="Beitrag absenden"/>
    </form>
</%block>
